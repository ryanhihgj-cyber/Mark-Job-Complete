const SPREADSHEET_ID = '1_0v_RlwrWDMUAl24j6r0eKhzeoYPyp63ckaLE2ssg9g';
const SHEET_NAME = 'Jobs List';

/**
 * Handles POST requests to mark a row as complete in a Google Sheet.
 * @param {Object} e - The event parameter containing POST data.
 * @return {ContentService.TextOutput} - JSON response indicating success or failure.
 */
function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const rowIndex = parseInt(data.rowIndex, 10);

    const sheet = SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName(SHEET_NAME);
    const headers = sheet.getDataRange().getValues()[0];
    const completeIndex = headers.indexOf("Marked Complete");
    const percentIndex = headers.indexOf("Percent Complete");

    if (completeIndex === -1 || percentIndex === -1) {
      throw new Error("Required headers not found");
    }

    const numRows = sheet.getLastRow();
    if (rowIndex < 0 || rowIndex >= numRows - 1) {
      throw new Error("Invalid rowIndex");
    }

    sheet.getRange(rowIndex + 1, completeIndex + 1).setValue(true);
    sheet.getRange(rowIndex + 1, percentIndex + 1).setValue(100);

    return ContentService.createTextOutput(JSON.stringify({ success: true }))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (err) {
    console.error(err);
    return ContentService.createTextOutput(JSON.stringify({ success: false, error: err.message }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
